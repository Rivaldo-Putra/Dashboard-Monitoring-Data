<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transaksi Panen</title>
  <link rel="icon" href="../assets/icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {--primary:#04b40d;--bg:#f9fafb;--text:#1f2937;--border:#e5e7eb;--danger:#ef4444;}
    * {box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;}
    body {background:var(--bg);color:var(--text);padding:20px;}
    header {background:var(--primary);color:#fff;padding:16px 20px;border-radius:12px 12px 0 0;box-shadow:0 4px 12px rgba(0,0,0,.08);position:sticky;top:0;z-index:100;}
    header h1 {font-size:1.3rem;font-weight:700;}
    nav a {color:#fff;text-decoration:none;font-weight:600;margin-left:12px;}
    main {max-width:800px;margin:30px auto;}
    .form-container {background:#fff;padding:24px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);margin-bottom:24px;}
    .form-group {margin-bottom:16px;}
    .form-group label {display:block;margin-bottom:6px;font-weight:600;color:#374151;}
    .form-group input, .form-group select {width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:1rem;}
    .btn {padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.9rem;}
    .btn-primary {background:var(--primary);color:#fff;}
    .btn-secondary {background:#6b7280;color:#fff;margin-left:8px;}
    table {width:100%;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);}
    thead {background:var(--primary);color:#fff;}
    th, td {padding:14px;text-align:left;}
    tbody tr {border-bottom:1px solid #eee;}
    .action-btn {padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-size:.8rem;margin:0 4px;}
    .edit {background:#f59e0b;color:#fff;}
    .delete {background:var(--danger);color:#fff;}
    .empty {text-align:center;padding:30px;color:#9ca3af;font-style:italic;}
  </style>
</head>
<body>

<header>
  <h1>Transaksi Panen</h1>
  <nav>
    <a href="../admin.html">Kembali</a>
  </nav>
</header>

<main>
  <div class="form-container" id="editForm" style="display:none;">
    <h3>Edit Transaksi</h3>
    <form id="editTransForm">
      <div class="form-group">
        <label>Kategori</label>
        <select id="editCat"></select>
      </div>
      <div class="form-group">
        <label>Jumlah (kg)</label>
        <input type="number" id="editAmount" placeholder="250" />
      </div>
      <div class="form-group">
        <label>Tanggal</label>
        <input type="date" id="editDate" />
      </div>
      <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
      <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Batal</button>
    </form>
  </div>

  <div class="form-container">
    <h3>Tambah Transaksi Baru</h3>
    <form id="addForm">
      <div class="form-group">
        <label>Kategori</label>
        <select id="addCat" required></select>
      </div>
      <div class="form-group">
        <label>Jumlah (kg)</label>
        <input type="number" id="addAmount" placeholder="250" required />
      </div>
      <div class="form-group">
        <label>Tanggal</label>
        <input type="date" id="addDate" required />
      </div>
      <button type="submit" class="btn btn-primary">Simpan Transaksi</button>
    </form>
  </div>

  <table>
    <thead>
      <tr><th>No</th><th>Kategori</th><th>Jumlah (kg)</th><th>Tanggal</th><th>Aksi</th></tr>
    </thead>
    <tbody id="transBody"></tbody>
  </table>
</main>

<script>
let editIndex = null;

function loadCategories(selectId) {
  const cats = JSON.parse(localStorage.getItem('categories') || '[]');
  const select = document.getElementById(selectId);
  select.innerHTML = '<option value="">Pilih Kategori</option>';
  cats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c.name;
    opt.textContent = c.name;
    select.appendChild(opt);
  });
}

function loadTransactions() {
  const trxs = JSON.parse(localStorage.getItem('transactions') || '[]');
  const tbody = document.getElementById('transBody');
  tbody.innerHTML = trxs.length ? trxs.map((t, i) => `
    <tr>
      <td>${i+1}</td>
      <td>${t.category}</td>
      <td>${t.amount}</td>
      <td>${new Date(t.date).toLocaleDateString('id-ID')}</td>
      <td>
        <button class="action-btn edit" onclick="startEdit(${i})">Edit</button>
        <button class="action-btn delete" onclick="del(${i})">Hapus</button>
      </td>
    </tr>
  `).join('') : `<tr><td colspan="5" class="empty">Belum ada transaksi</td></tr>`;
}

function startEdit(i) {
  const trxs = JSON.parse(localStorage.getItem('transactions') || '[]');
  loadCategories('editCat');
  document.getElementById('editCat').value = trxs[i].category;
  document.getElementById('editAmount').value = trxs[i].amount;
  document.getElementById('editDate').value = trxs[i].date;
  editIndex = i;
  document.getElementById('editForm').style.display = 'block';
}

function saveEdit() {
  const cat = document.getElementById('editCat').value;
  const amount = document.getElementById('editAmount').value;
  const date = document.getElementById('editDate').value;
  if (!cat || !amount || !date) return alert('Semua field wajib diisi!');

  const trxs = JSON.parse(localStorage.getItem('transactions') || '[]');
  trxs[editIndex] = { category: cat, amount: parseInt(amount), date };
  localStorage.setItem('transactions', JSON.stringify(trxs));
  cancelEdit();
  loadTransactions();
}

function cancelEdit() {
  editIndex = null;
  document.getElementById('editForm').style.display = 'none';
}

function del(i) {
  if (!confirm('Hapus transaksi ini?')) return;
  const trxs = JSON.parse(localStorage.getItem('transactions') || '[]');
  trxs.splice(i, 1);
  localStorage.setItem('transactions', JSON.stringify(trxs));
  loadTransactions();
}

// Tambah transaksi
document.getElementById('addForm').onsubmit = function(e) {
  e.preventDefault();
  const cat = document.getElementById('addCat').value;
  const amount = document.getElementById('addAmount').value;
  const date = document.getElementById('addDate').value;
  if (!cat || !amount || !date) return alert('Semua field wajib diisi!');

  const trxs = JSON.parse(localStorage.getItem('transactions') || '[]');
  trxs.push({ category: cat, amount: parseInt(amount), date });
  localStorage.setItem('transactions', JSON.stringify(trxs));
  this.reset();
  document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
  loadTransactions();
  alert('Transaksi berhasil disimpan!');
};

// Edit form
document.getElementById('editTransForm').onsubmit = function(e) {
  e.preventDefault();
  saveEdit();
};

window.onload = function() {
  loadCategories('addCat');
  loadCategories('editCat');
  document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
  loadTransactions();
};
</script>

</body>
</html>