<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Pertanian</title>
  <style>
    :root{--green:#28a044;--dark:#123;--white:#fff;--gray:#f8f9fa;--red:#dc2626;--orange:#f59e0b}
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,Arial,sans-serif;
      margin:0;
      background:url('./assets/Harvest.jpg') center/cover no-repeat fixed;
      color:var(--dark);
      min-height:100vh;
    }
    header{
      background:var(--green);color:#fff;padding:14px 20px;display:flex;justify-content:space-between;align-items:center;
      box-shadow:0 2px 10px rgba(0,0,0,.1);position:relative;z-index:10
    }
    .brand{font-weight:700;font-size:1.2rem}
    nav a{color:#fff;text-decoration:none;margin-left:16px;font-size:.95rem}
    nav a:hover{text-decoration:underline}
    .logout{background:var(--red);color:#fff;padding:6px 12px;border:none;border-radius:6px;font-size:.85rem;cursor:pointer}
    .container{max-width:1100px;margin:40px auto;padding:16px;text-align:center}
    .hero{position:relative;margin-bottom:40px}
    .hero h1{font-size:2.5rem;color:var(--dark);margin-bottom:8px}
    .hero p{font-size:1.1rem;color:#555}
    .btn-group{margin:20px 0;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .btn{background:var(--green);color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600}
    .btn:hover{background:#218838}
    .btn.red{background:var(--red)}
    .btn.red:hover{background:#c82333}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:30px}
    .card{background:var(--white);padding:24px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,.12);text-align:left}
    .card h3{margin-bottom:12px;color:var(--green)}
    .card p{margin:8px 0;font-size:1rem}
    .card strong{color:var(--green);font-weight:600}
    .card .btn{margin-top:12px;width:100%;padding:10px}
    .hidden{display:none}

    /* FORM LOGIN & DAFTAR */
    .form-card{max-width:460px;margin:40px auto;background:#fff;padding:32px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,.12)}
    .form-card h2{margin-bottom:20px;color:var(--green);text-align:center}
    .form-control{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin:10px 0;font-size:1rem}
    .form-control:focus{outline:none;border-color:var(--green);box-shadow:0 0 0 3px rgba(40,160,68,.2)}

    /* POPUP BOXES */
    .popup-overlay{
      position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);
      display:flex;justify-content:center;align-items:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity .3s
    }
    .popup-overlay.show{opacity:1;visibility:visible}
    .popup{
      background:#fff;padding:30px;border-radius:16px;max-width:460px;width:90%;box-shadow:0 15px 40px rgba(0,0,0,.2);
      animation:pop 0.3s ease-out
    }
    @keyframes pop{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
    .popup h3{margin-bottom:16px;color:var(--green);text-align:center}
    .popup input, .popup select{
      width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin:10px 0;font-size:1rem
    }
    .popup .btn-group{margin-top:20px;display:flex;gap:10px;justify-content:center}

    /* TOAST */
    #snackbar{
      visibility:hidden;min-width:300px;background:#333;color:#fff;text-align:center;
      border-radius:8px;padding:16px;position:fixed;left:50%;bottom:30px;transform:translateX(-50%);
      z-index:1001;opacity:0;transition:all .4s;box-shadow:0 4px 12px rgba(0,0,0,.15);font-size:.95rem
    }
    #snackbar.show{visibility:visible;opacity:1;transform:translateX(-50%) translateY(0)}
    #snackbar.success{background:#16a34a}
    #snackbar.error{background:var(--red)}
    #snackbar.info{background:#0d6efd}
  </style>
</head>
<body>

<header>
  <div class="brand">Dashboard Pertanian</div>
  <nav>
    <a href="#" onclick="showPage('beranda')">Beranda</a>
    <a href="#" onclick="showPage('login')" id="navLogin">Login</a>
    <a href="#" onclick="showPage('daftar')" id="navDaftar">Daftar</a>
    <span id="userInfo" style="margin-left:12px"></span>
    <button class="logout hidden" id="btnLogout" onclick="logout()">Logout</button>
  </nav>
</header>

<!-- BERANDA -->
<div id="page-beranda" class="container">
  <div class="hero">
    <h1>Selamat Datang, Petani!</h1>
    <p>Sistem monitoring tanaman & panen</p>
    <div class="btn-group">
      <button class="btn" onclick="showPage('login')">Login</button>
      <button class="btn" onclick="showPage('daftar')">Daftar</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>Statistik</h3>
      <p>Kategori: <strong id="countCat">0</strong></p>
      <p>Transaksi: <strong id="countTrx">0</strong></p>
      <button class="btn" onclick="toDashboard()">Buka Dashboard</button>
    </div>

    <div class="card">
      <h3>Aksi Cepat</h3>
      <button class="btn" onclick="addCatDemo()">Tambah Kategori Demo</button>
      <button class="btn" onclick="addTrxDemo()">Tambah Transaksi Demo</button>
      <button class="btn" onclick="openAddCat()">Tambah Kategori</button>
      <button class="btn" onclick="openAddTrx()">Tambah Transaksi</button>
    </div>

    <div class="card">
      <h3>Tes Notifikasi</h3>
      <button class="btn" onclick="showToast('Sukses! Data tersimpan.', 'success')">Toast Sukses</button>
      <button class="btn red" onclick="showToast('Error! Gagal simpan.', 'error')">Toast Error</button>
      <button class="btn" style="background:var(--orange)" onclick="showToast('Info! Cek data.', 'info')">Toast Info</button>
      <button class="btn" onclick="fetchQuote()">Ambil Quote</button>
    </div>
  </div>
</div>

<!-- HALAMAN LOGIN -->
<div id="page-login" class="container hidden">
  <div class="form-card">
    <h2>Login Petani</h2>
    <form id="formLogin">
      <input type="email" id="emailLogin" class="form-control" placeholder="Email" required />
      <input type="password" id="passLogin" class="form-control" placeholder="Kata Sandi" required minlength="6" />
      <button type="submit" class="btn">Masuk</button>
    </form>
  </div>
</div>

<!-- HALAMAN DAFTAR -->
<div id="page-daftar" class="container hidden">
  <div class="form-card">
    <h2>Daftar Petani</h2>
    <form id="formDaftar">
      <input type="text" id="namaDaftar" class="form-control" placeholder="Nama Lengkap" required />
      <input type="email" id="emailDaftar" class="form-control" placeholder="Email" required />
      <input type="password" id="passDaftar" class="form-control" placeholder="Kata Sandi" required minlength="6" />
      <select id="provDaftar" class="form-control" required>
        <option value="">Pilih Provinsi</option>
        <option>Jawa Barat</option>
        <option>Jawa Tengah</option>
        <option>Jawa Timur</option>
      </select>
      <button type="submit" class="btn">Daftar</button>
    </form>
  </div>
</div>

<!-- POPUP 1: TAMBAH KATEGORI -->
<div id="popupCat" class="popup-overlay">
  <div class="popup">
    <h3>Tambah Kategori</h3>
    <input type="text" id="newCatName" placeholder="Nama Kategori" maxlength="50">
    <div class="btn-group">
      <button class="btn" onclick="saveCat()">Simpan</button>
      <button class="btn red" onclick="closePopup('popupCat')">Batal</button>
    </div>
  </div>
</div>

<!-- POPUP 2: TAMBAH TRANSAKSI -->
<div id="popupTrx" class="popup-overlay">
  <div class="popup">
    <h3>Tambah Transaksi</h3>
    <input type="text" id="newTrxJudul" placeholder="Judul Transaksi">
    <input type="number" id="newTrxJumlah" placeholder="Jumlah (Rp)" step="0.01">
    <select id="newTrxStatus">
      <option value="Belum Dibayar">Belum Dibayar</option>
      <option value="Sudah Dibayar">Sudah Dibayar</option>
    </select>
    <div class="btn-group">
      <button class="btn" onclick="saveTrx()">Simpan</button>
      <button class="btn red" onclick="closePopup('popupTrx')">Batal</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="snackbar"></div>

<script>
  // === DATA ===
  let categories = JSON.parse(localStorage.getItem('categories') || '[]');
  let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

  // === TOAST ===
  function showToast(msg, type = 'default', dur = 3000) {
    const s = document.getElementById('snackbar');
    s.textContent = msg;
    s.className = 'show ' + type;
    setTimeout(() => s.className = '', dur);
  }

  // === UPDATE STATS ===
  function updateStats() {
    document.getElementById('countCat').textContent = categories.length;
    document.getElementById('countTrx').textContent = transactions.length;
    localStorage.setItem('categories', JSON.stringify(categories));
    localStorage.setItem('transactions', JSON.stringify(transactions));
  }

  // === POPUP CONTROL ===
  function openPopup(id) { document.getElementById(id).classList.add('show'); }
  function closePopup(id) { document.getElementById(id).classList.remove('show'); }

  // === POPUP 1 & 2 ===
  function openAddCat() { openPopup('popupCat'); document.getElementById('newCatName').focus(); }
  function saveCat() {
    const name = document.getElementById('newCatName').value.trim();
    if (!name) return showToast('Nama kategori wajib diisi!', 'error');
    categories.push({ name, createdAt: new Date().toLocaleString('id-ID') });
    updateStats(); closePopup('popupCat'); document.getElementById('newCatName').value = '';
    showToast('Kategori berhasil ditambah!', 'success');
  }

  function openAddTrx() { openPopup('popupTrx'); document.getElementById('newTrxJudul').focus(); }
  function saveTrx() {
    const judul = document.getElementById('newTrxJudul').value.trim();
    const jumlah = parseFloat(document.getElementById('newTrxJumlah').value);
    const status = document.getElementById('newTrxStatus').value;
    if (!judul || isNaN(jumlah) || jumlah <= 0) return showToast('Isi data dengan benar!', 'error');
    transactions.push({ judul, jumlah, status, createdAt: new Date().toLocaleString('id-ID') });
    updateStats(); closePopup('popupTrx');
    document.getElementById('newTrxJudul').value = '';
    document.getElementById('newTrxJumlah').value = '';
    showToast('Transaksi berhasil dicatat!', 'success');
  }

  // === DEMO ===
  function addCatDemo() {
    categories.push({ name: 'Padi IR64', createdAt: new Date().toLocaleString('id-ID') });
    updateStats(); showToast('Kategori demo ditambah!', 'success');
  }
  function addTrxDemo() {
    transactions.push({ judul: 'Panen Padi', jumlah: 2500000, status: 'Sudah Dibayar', createdAt: new Date().toLocaleString('id-ID') });
    updateStats(); showToast('Transaksi demo dicatat!', 'success');
  }

  // === 5 EVENT ===
  document.querySelector('header').addEventListener('dblclick', () => {
    const colors = ['#28a044', '#218838', '#1e7e34', '#2f855a'];
    document.querySelector('header').style.background = colors[Math.floor(Math.random() * colors.length)];
    showToast('Warna header diacak!', 'info');
  });

  document.getElementById('newCatName').addEventListener('keypress', e => { if (e.key === 'Enter') saveCat(); });
  document.getElementById('newTrxJudul').addEventListener('keypress', e => { if (e.key === 'Enter') saveTrx(); });

  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('mouseenter', () => card.style.boxShadow = '0 12px 35px rgba(0,0,0,.2)');
    card.addEventListener('mouseleave', () => card.style.boxShadow = '0 8px 25px rgba(0,0,0,.12)');
  });

  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const current = window.pageYOffset;
    if (current > lastScroll + 300) { lastScroll = current; fetchQuote(); }
  });

  document.addEventListener('contextmenu', e => { e.preventDefault(); showToast('Klik kanan dinonaktifkan!', 'info'); });

  async function fetchQuote() {
    try {
      const res = await fetch('https://api.quotable.io/random');
      const d = await res.json();
      showToast(`"${d.content}" â€” ${d.author}`, 'info', 6000);
    } catch { showToast('Gagal ambil quote', 'error'); }
  }

  // === NAVIGASI ===
  function showPage(page) {
    document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('hidden'));
    document.getElementById(`page-${page}`).classList.remove('hidden');
    updateNav();
  }

  function toDashboard() {
    const u = JSON.parse(localStorage.getItem('user') || '{"isLoggedIn":false}');
    if (!u.isLoggedIn) { showToast('Login dulu!', 'error'); showPage('login'); return; }
    showToast('Menuju dashboard...', 'success');
    setTimeout(() => location.href = 'dashboard.html', 1000);
  }

  function logout() {
    localStorage.removeItem('user');
    showToast('Logout berhasil', 'success');
    showPage('beranda');
  }

  function updateNav() {
    const u = JSON.parse(localStorage.getItem('user') || '{"isLoggedIn":false}');
    document.getElementById('navLogin').classList.toggle('hidden', u.isLoggedIn);
    document.getElementById('navDaftar').classList.toggle('hidden', u.isLoggedIn);
    document.getElementById('btnLogout').classList.toggle('hidden', !u.isLoggedIn);
    document.getElementById('userInfo').textContent = u.isLoggedIn ? `(${u.email})` : '';
  }

  // === LOGIN & DAFTAR ===
  document.getElementById('formDaftar').onsubmit = e => {
    e.preventDefault();
    const n = document.getElementById('namaDaftar').value.trim();
    const em = document.getElementById('emailDaftar').value.trim();
    const p = document.getElementById('passDaftar').value;
    const prov = document.getElementById('provDaftar').value;
    if (!n || !em || !p || !prov) return showToast('Isi semua!', 'error');
    const daftar = JSON.parse(localStorage.getItem('daftarPetani') || '[]');
    if (daftar.some(x => x.email === em)) return showToast('Email sudah ada', 'error');
    daftar.push({nama: n, email: em, password: p, provinsi: prov});
    localStorage.setItem('daftarPetani', JSON.stringify(daftar));
    localStorage.setItem('user', JSON.stringify({isLoggedIn: true, nama: n, email: em}));
    showToast('Daftar sukses!', 'success');
    setTimeout(() => showPage('beranda'), 1500);
  };

  document.getElementById('formLogin').onsubmit = e => {
    e.preventDefault();
    const em = document.getElementById('emailLogin').value.trim();
    const p = document.getElementById('passLogin').value;
    const user = JSON.parse(localStorage.getItem('daftarPetani') || '[]').find(x => x.email === em && x.password === p);
    if (!user) return showToast('Email atau sandi salah!', 'error');
    localStorage.setItem('user', JSON.stringify({isLoggedIn: true, nama: user.nama, email: em}));
    showToast('Login sukses!', 'success');
    setTimeout(() => showPage('beranda'), 1500);
  };

  // === INIT ===
  window.addEventListener('load', () => {
    updateStats();
    const u = JSON.parse(localStorage.getItem('user') || '{"isLoggedIn":false}');
    showPage(u.isLoggedIn ? 'beranda' : 'beranda');
  });
</script>
</body>
</html>